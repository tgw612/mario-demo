<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mall.discover.persistence.dao.mysql.ClientRelationMapper">

    <select id="queryFromIdPage" resultType="java.lang.Integer">
        select from_id from discover_relations
        where to_id = #{toId}
        and is_deleted = 0
        LIMIT #{startRecord},#{recordSize}
    </select>

    <select id="queryFromIdCount" resultType="java.lang.Integer">
        select count(from_id) from discover_relations
        where to_id = #{toId}
        and is_deleted = 0
    </select>

    <insert id="batchAddRelation">
        INSERT INTO discover_relations (relationtype, from_id, to_id, count, create_time, update_time, create_user_id )
        VALUES
        <foreach collection="list" index="index" item="param" separator=",">
            (#{param.relationType}, #{param.fromId}, #{toId}, #{param.count}, #{param.createTime}, #{param.updateTime}, #{param.createUserId})
        </foreach>
    </insert>

    <update id="batchRemoveByToId">
        UPDATE discover_relations
        SET is_deleted = 1
        WHERE
            to_id = #{toId}
            AND relationtype = #{relationType}
            AND from_id in
            <foreach collection="list" separator="," open="(" close=")" item="fromId">
                #{fromId}
            </foreach>
    </update>
</mapper>